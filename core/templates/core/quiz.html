{% extends 'core/base.html' %}

{% block title %}Астрологический опросник - Зеркало Души{% endblock %}

{% block content %}
<div class="quiz-container">
    <h1>✨ Откройте свой внутренний знак зодиака</h1>
    <p class="subtitle">Ответьте на 5 вопросов, чтобы мы могли определить ваш истинный астрологический профиль</p>

    <form method="post" class="quiz-form">
        {% csrf_token %}

        <div class="question-card">
            <h3>Ваш знак зодиака по дате рождения:</h3>
            <select name="birth_sign" required class="form-select">
                <option value="">Выберите знак</option>
                {% for sign in zodiac_signs %}
                <option value="{{ sign.name }}">{{ sign.get_name_display }}</option>
                {% endfor %}
            </select>
        </div>

        {% for question in questions %}
        <div class="question-card">
            <h3>{{ forloop.counter }}. {{ question.question_text }}</h3>
            <div class="answers-list">
                {% for answer in question.answers.all %}
                <label class="answer-option">
                    <input type="radio" name="question_{{ question.id }}" value="{{ answer.id }}" required>
                    <span>{{ answer.answer_text }}</span>
                </label>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        <button type="submit" class="btn btn-primary btn-large" id="submitBtn">
            <span class="btn-text">Узнать свой внутренний знак</span>
            <span class="btn-loader" style="display: none;">
                <span class="spinner"></span> Анализируем ответы...
            </span>
        </button>
    </form>
</div>

<style>
.spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
    vertical-align: middle;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.btn-loader {
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.quiz-form');
    const submitBtn = document.getElementById('submitBtn');

    if (form && submitBtn) {
        form.addEventListener('submit', function() {
            submitBtn.disabled = true;
            submitBtn.querySelector('.btn-text').style.display = 'none';
            submitBtn.querySelector('.btn-loader').style.display = 'flex';
        });
    }
});
</script>
{% endblock %}
