{% extends 'core/base.html' %}

{% block title %}–ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ - –ó–µ—Ä–∫–∞–ª–æ –î—É—à–∏{% endblock %}

{% block content %}
<div class="natal-chart-container">
    <h1>üåü –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞</h1>
    <p class="subtitle">–†–∞—Å–∫—Ä–æ–π—Ç–µ —Å–≤–æ–π –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —á–µ—Ä–µ–∑ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—é</p>

    {% if existing_chart %}
    <div class="existing-chart-notice">
        <h3>‚ú® –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –Ω–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞</h3>
        <p>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: {{ existing_chart.birth_date }}</p>
        {% if existing_chart.birth_time %}
        <p>–í—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è: {{ existing_chart.birth_time }}</p>
        {% endif %}
        <a href="#view-chart" class="btn btn-secondary" onclick="showExistingChart()">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ä—Ç—É</a>
        <p style="margin-top: 15px; color: var(--text-muted);">–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:</p>
    </div>
    {% endif %}

    <div class="natal-form-card">
        <form method="post" class="natal-form">
            {% csrf_token %}

            <div class="form-group">
                <label for="birth_date">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                <input
                    type="date"
                    id="birth_date"
                    name="birth_date"
                    required
                    {% if existing_chart %}value="{{ existing_chart.birth_date|date:'Y-m-d' }}"{% endif %}
                >
                <small>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª–æ–∂–µ–Ω–∏—è –°–æ–ª–Ω—Ü–∞ –∏ –ø–ª–∞–Ω–µ—Ç</small>
            </div>

            <div class="form-group">
                <label for="birth_time">–í—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input
                    type="time"
                    id="birth_time"
                    name="birth_time"
                    {% if existing_chart.birth_time %}value="{{ existing_chart.birth_time|time:'H:i' }}"{% endif %}
                >
                <small>–î–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –∫–∞—Ä—Ç—ã —É–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è</small>
            </div>

            <div class="form-group">
                <label for="birth_place">–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input
                    type="text"
                    id="birth_place"
                    name="birth_place"
                    placeholder="–ú–æ—Å–∫–≤–∞, –†–æ—Å—Å–∏—è"
                    {% if existing_chart %}value="{{ existing_chart.birth_place }}"{% endif %}
                >
                <small>–ì–æ—Ä–æ–¥ –∏ —Å—Ç—Ä–∞–Ω–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</small>
            </div>

            <button type="submit" class="btn btn-primary btn-large" id="submitBtn">
                <span class="btn-text">üåü –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É</span>
                <span class="btn-loader" style="display: none;">
                    <span class="spinner"></span> –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É...
                </span>
            </button>
        </form>
    </div>

    {% if existing_chart %}
    <div id="existing-chart-section" style="display: none; margin-top: 40px;">
        <div class="chart-result-card">
            <h2>–í–∞—à–∞ –Ω–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞</h2>

            <div class="chart-visual">
                <h3>–ü–æ–ª–æ–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç</h3>
                <div class="planets-grid">
                    {% for planet, data in existing_chart.planets.items %}
                    <div class="planet-item">
                        <span class="planet-name">{{ planet }}</span>
                        <span class="planet-position">{{ data.sign }} ({{ data.house }} –¥–æ–º)</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="interpretations">
                <div class="interpretation-section">
                    <h3>üåû –û–±—â–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</h3>
                    <p>{{ existing_chart.personality_reading }}</p>
                </div>

                <div class="interpretation-section">
                    <h3>üíº –ö–∞—Ä—å–µ—Ä–∞ –∏ –ø—Ä–∏–∑–≤–∞–Ω–∏–µ</h3>
                    <p>{{ existing_chart.career_reading }}</p>
                </div>

                <div class="interpretation-section">
                    <h3>‚ù§Ô∏è –û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ª—é–±–æ–≤—å</h3>
                    <p>{{ existing_chart.relationships_reading }}</p>
                </div>

                <div class="interpretation-section">
                    <h3>‚ú® –ñ–∏–∑–Ω–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</h3>
                    <p>{{ existing_chart.life_purpose_reading }}</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
    vertical-align: middle;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.btn-loader {
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>

<script>
function showExistingChart() {
    const section = document.getElementById('existing-chart-section');
    if (section) {
        section.style.display = 'block';
        section.scrollIntoView({ behavior: 'smooth' });
    }
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.natal-form');
    const submitBtn = document.getElementById('submitBtn');

    if (form && submitBtn) {
        form.addEventListener('submit', function() {
            submitBtn.disabled = true;
            submitBtn.querySelector('.btn-text').style.display = 'none';
            submitBtn.querySelector('.btn-loader').style.display = 'flex';
        });
    }
});
</script>
{% endblock %}
