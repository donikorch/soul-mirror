{% extends 'core/base.html' %}

{% block title %}–¢–∞—Ä–æ - –ó–µ—Ä–∫–∞–ª–æ –î—É—à–∏{% endblock %}

{% block content %}
<div class="tarot-container">
    <h1>üîÆ –†–∞—Å–∫–ª–∞–¥ –¢–∞—Ä–æ</h1>
    <p class="subtitle">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∑–≤–µ–∑–¥–∞–º –∏ –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç</p>

    <div class="tarot-form-card">
        <form method="post" class="tarot-form">
            {% csrf_token %}

            <div class="form-group">
                <label for="question">–í–∞—à –≤–æ–ø—Ä–æ—Å:</label>
                <textarea
                    id="question"
                    name="question"
                    rows="4"
                    placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–∞—Å –≤–æ–ª–Ω—É–µ—Ç..."
                    required
                ></textarea>
            </div>

            <button type="submit" class="btn btn-primary btn-large" id="submitBtn">
                <span class="btn-text">üîÆ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å–∫–ª–∞–¥</span>
                <span class="btn-loader" style="display: none;">
                    <span class="spinner"></span> –ö–∞—Ä—Ç—ã —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è...
                </span>
            </button>
        </form>
    </div>

    {% if readings %}
    <div class="readings-history">
        <h2>–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å–∫–ª–∞–¥–æ–≤</h2>
        <div class="readings-list">
            {% for reading in readings %}
            <div class="reading-card">
                <div class="reading-date">{{ reading.created_at|date:"d.m.Y H:i" }}</div>
                <div class="reading-question">
                    <strong>–í–æ–ø—Ä–æ—Å:</strong> {{ reading.question }}
                </div>
                <div class="reading-cards">
                    <strong>–ö–∞—Ä—Ç—ã:</strong>
                    <ul>
                        {% for card in reading.cards %}
                        <li>{{ card.position }}: <strong>{{ card.card }}</strong></li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="reading-interpretation">
                    <strong>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:</strong>
                    <p>{{ reading.interpretation }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<style>
.spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-right: 8px;
    vertical-align: middle;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.btn-loader {
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.tarot-form');
    const submitBtn = document.getElementById('submitBtn');

    if (form && submitBtn) {
        form.addEventListener('submit', function() {
            submitBtn.disabled = true;
            submitBtn.querySelector('.btn-text').style.display = 'none';
            submitBtn.querySelector('.btn-loader').style.display = 'flex';
        });
    }
});
</script>
{% endblock %}
